{
  "hash": "73282ff540dc7add693efc71993d56bd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Uncovering Predictors of Gallstone Disease Across Age, Sex, and Obesity Subgroups\"\nauthor: \"Anna Calderon\"\ndate: \"2025-09-10\"\nformat:\n  html:\n    code-fold: true\n---\n\n\n\n\n\n\n## Subgroup Analysis Overview\n\nRather than building a single predictive model, this analysis focuses on **subgroup-level exploration** to identify how important predictors of gallstone disease may differ based on individual characteristics.\n\n### Objectives:\n- Understand which predictors are **most important** within each subgroup using **Gradient Boosted Machines (GBM)**.\n- Assess whether predictors are **positively or negatively associated** with gallstone status using **logistic regression coefficients**.\n- Visualize the **top 8–15 variables** per group to highlight contrasts between groups.\n\n### Why Subgroups?\nExploring model results by subgroups allows us to:\n- Identify predictors that may be more relevant in **specific populations** (e.g., hepatic fat in older adults vs cholesterol in younger women).\n- Support **personalized health recommendations** by uncovering **distinct risk profiles**.\n\nThis approach aligns with **precision medicine**, which emphasizes tailoring diagnostics and interventions based on characteristics like age, sex, and body composition.\n\n\n\n\n\n\n\n\n\n\n\n\n### Sex-Specific Predictors\n\nTo examine whether predictive factors differ by sex, separate gradient boosting models were trained for males and females. As shown in the visualization below, **C-Reactive Protein (CRP)** emerged as the top predictor for both sexes, but its relative importance was much higher in females (100%) compared to males (also 100%, but with a smaller drop-off across other variables). Other predictors like **Vitamin D**, **Extracellular Water**, and **Hemoglobin** also showed distinct patterns between groups.\n\n**Key Insight**:  \nCRP, Vitamin D, and protein-related metrics appear to be more influential in women, suggesting potential physiological or hormonal differences in gallstone susceptibility.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(caret)\nlibrary(tidyverse)\nlibrary(forcats)\n\n\n# Extract and label variable importance\nmale_imp_df <- varImp(gbm_male)$importance %>%\n  rownames_to_column(\"Variable\") %>%\n  left_join(labels_variables, by = c(\"Variable\" = \"name\")) %>%\n  mutate(\n    Variable = coalesce(label, Variable),\n    Group = \"Male\"\n  ) %>%\n  select(-label) %>%\n  arrange(desc(Overall)) %>%\n  head(8) %>%\n  mutate(\n    Variable = factor(Variable, levels = rev(Variable)),\n    RelativeImportance = 100 * Overall / max(Overall)\n  )\n\nfemale_imp_df <- varImp(gbm_female)$importance %>%\n  rownames_to_column(\"Variable\") %>%\n  left_join(labels_variables, by = c(\"Variable\" = \"name\")) %>%\n  mutate(\n    Variable = coalesce(label, Variable),\n    Group = \"Female\"\n  ) %>%\n  select(-label) %>%\n  arrange(desc(Overall)) %>%\n  head(8) %>%\n  mutate(\n    Variable = factor(Variable, levels = rev(Variable)),\n    RelativeImportance = 100 * Overall / max(Overall)\n  )\n\n# Combine datasets\n# imp_sex_df <- bind_rows(male_imp_df, female_imp_df)\n\n# Plot: Female\nfemale_plot <- ggplot(female_imp_df, aes(x = Variable, y = RelativeImportance)) +\n  geom_col(fill = \"salmon\") +\n  geom_text(aes(label = paste0(round(RelativeImportance, 1), \"%\")),\n            hjust = 1.1, color = \"white\", size = 3) +\n  labs(\n    title = \"Top Predictors of Gallstones by Sex\",\n    subtitle = \"Female\",\n    y = NULL,\n    x = NULL\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(axis.text.y = element_text(size = 10),\n        plot.title.position = \"plot\",           # aligns title relative to plot, not panel\n        plot.title = element_text(hjust = 0.5),\n        plot.subtitle = element_text(hjust = 0.5) ) + \n  coord_flip()\n\n# Plot: Male\nmale_plot <- ggplot(male_imp_df, aes(x = Variable, y = RelativeImportance)) +\n  geom_col(fill = \"steelblue\") +\n  geom_text(aes(label = paste0(round(RelativeImportance, 1), \"%\")),\n            hjust = 1.1, color = \"white\", size = 3) +\n  labs(\n    title = NULL,\n    subtitle = \"Male\",\n    y = \"Variable Importance (%)\",\n    x = NULL\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(axis.text.y = element_text(size = 10),\n        plot.title.position = \"plot\",           # aligns title relative to plot, not panel\n        plot.subtitle = element_text(hjust = 0.5) ) + \n  coord_flip()\n\n# Combine vertically\nfemale_plot / male_plot\n```\n\n::: {.cell-output-display}\n![](subgroups_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n### Stratify by Obesity Class\n\nNext, we stratified the dataset by obesity class—defined using body fat percentage—as **Normal**, **Obese**, and **Severely Obese**. Separate models for each group reveal that **CRP** remains a consistently strong predictor, but the relative importance of other features such as **Triglycerides**, **ECF/TBW**, and **Hemoglobin** varies across categories.\n\n**Key Insight**:  \nIn severely obese individuals, inflammatory markers and metabolic factors gain more importance, possibly reflecting the compounding effects of systemic inflammation.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_col(data = g1, aes(x = Variable, y = Overall, fill = Group), show.legend = FALSE) +\n  geom_col(data = g2, aes(x = Variable, y = Overall, fill = Group), show.legend = FALSE) +\n  geom_col(data = g3, aes(x = Variable, y = Overall, fill = Group), show.legend = FALSE) +\n  facet_wrap(~ Group, scales = \"free\", nrow = 1) +\n  coord_flip() +\n  scale_fill_manual(values = group_colors) +\n  labs(x = NULL, y = \"Importance\", title = \"Top Predictors by Obesity Class\") +\n  theme_minimal(base_size = 13) +\n  theme(\n    strip.text = element_text(size = 12, face = \"bold\"),\n    axis.text.x = element_text(size = 9, angle = 45, hjust = 1),\n    axis.ticks.x = element_line(),\n    panel.grid.major.x = element_line()\n  )\n```\n\n::: {.cell-output-display}\n![](subgroups_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n### Stratify by Age Class\nFinally, models were trained across age categories: **<40**, **40–59**, and **60+ years**. Again, **CRP** consistently tops the list across all age brackets, but we see shifting roles in variables like **Creatinine**, **Triglycerides**, **ALT**, and **Vitamin D**.\n\n**Key Insight**:  \nWhile CRP remains central, aging appears to increase the role of **kidney function** and **lipid metabolism** markers in predicting gallstones, especially in the 60+ age group.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_col(data = g1, aes(x = Variable, y = Overall, fill = Group), show.legend = FALSE) +\n  geom_col(data = g2, aes(x = Variable, y = Overall, fill = Group), show.legend = FALSE) +\n  geom_col(data = g3, aes(x = Variable, y = Overall, fill = Group), show.legend = FALSE) +\n  facet_wrap(~ Group, scales = \"free\", nrow = 1) +\n  coord_flip() +\n  scale_fill_manual(values = group_colors) +\n  labs(x = NULL, y = \"Importance\", title = \"Top Predictors by Age Class\") +\n  theme_minimal(base_size = 13) +\n  theme(\n    strip.text = element_text(size = 12, face = \"bold\"),\n    axis.text.x = element_text(size = 9, angle = 45, hjust = 1),\n    axis.ticks.x = element_line(),\n    panel.grid.major.x = element_line()\n  )\n```\n\n::: {.cell-output-display}\n![](subgroups_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n## Summary of the Dataset and Original Study\n\nThis analysis is based on data from the **UCI Gallbladder Disease Dataset**, originally published by Kocaay et al. (2020) in their clinical study on predicting gallstone disease using bioelectrical impedance and clinical markers.\n\n- **Study Title:** *\"Can Bioelectrical Impedance Analysis Be a New and Reliable Method for the Diagnosis of Gallstone Disease?\"*\n- **Authors:** Kocaay et al., 2020  \n- **Link to dataset:** [https://archive.ics.uci.edu/ml/datasets/Gallbladder+Disease](https://archive.ics.uci.edu/ml/datasets/Gallbladder+Disease)  \n- **DOI:** [10.14744/tjtes.2019.17317](https://doi.org/10.14744/tjtes.2019.17317)\n\nThe dataset contains information on 540 patients, including:\n- Demographic features: age, sex  \n- Body composition: BMI, visceral fat, hepatic fat, lean mass  \n- Biochemical markers: cholesterol, glucose, ALT, AST, etc.  \n- Target variable: gallstone status (present vs absent)\n\nThe goal of the original study was to assess whether **body composition metrics could improve the diagnosis of gallstone disease**.\n\n",
    "supporting": [
      "subgroups_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
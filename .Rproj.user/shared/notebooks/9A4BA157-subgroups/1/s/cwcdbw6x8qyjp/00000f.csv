"0","library(caret)"
"0","library(tidyverse)"
"0","library(forcats)"
"0",""
"0",""
"0","# Extract and label variable importance"
"0","male_imp_df <- varImp(gbm_male)$importance %>%"
"0","  rownames_to_column(""Variable"") %>%"
"0","  left_join(labels_variables, by = c(""Variable"" = ""name"")) %>%"
"0","  mutate("
"0","    Variable = coalesce(label, Variable),"
"0","    Group = ""Male"""
"0","  ) %>%"
"0","  select(-label) %>%"
"0","  arrange(desc(Overall)) %>%"
"0","  head(8) %>%"
"0","  mutate("
"0","    Variable = factor(Variable, levels = rev(Variable)),"
"0","    RelativeImportance = 100 * Overall / max(Overall)"
"0","  )"
"0",""
"0","female_imp_df <- varImp(gbm_female)$importance %>%"
"0","  rownames_to_column(""Variable"") %>%"
"0","  left_join(labels_variables, by = c(""Variable"" = ""name"")) %>%"
"0","  mutate("
"0","    Variable = coalesce(label, Variable),"
"0","    Group = ""Female"""
"0","  ) %>%"
"0","  select(-label) %>%"
"0","  arrange(desc(Overall)) %>%"
"0","  head(8) %>%"
"0","  mutate("
"0","    Variable = factor(Variable, levels = rev(Variable)),"
"0","    RelativeImportance = 100 * Overall / max(Overall)"
"0","  )"
"0",""
"0","# Combine datasets"
"0","# imp_sex_df <- bind_rows(male_imp_df, female_imp_df)"
"0",""
"0","# Plot: Female"
"0","female_plot <- ggplot(female_imp_df, aes(x = Variable, y = RelativeImportance)) +"
"0","  geom_col(fill = ""salmon"") +"
"0","  geom_text(aes(label = paste0(round(RelativeImportance, 1), ""%"")),"
"0","            hjust = 1.1, color = ""white"", size = 3) +"
"0","  labs("
"0","    title = ""Top Predictors of Gallstones by Sex"","
"0","    subtitle = ""Female"","
"0","    y = NULL,"
"0","    x = NULL"
"0","  ) +"
"0","  theme_minimal(base_size = 14) +"
"0","  theme(axis.text.y = element_text(size = 10),"
"0","        plot.title.position = ""plot"",           # aligns title relative to plot, not panel"
"0","        plot.title = element_text(hjust = 0.5),"
"0","        plot.subtitle = element_text(hjust = 0.5) ) + "
"0","  coord_flip()"
"0",""
"0","# Plot: Male"
"0","male_plot <- ggplot(male_imp_df, aes(x = Variable, y = RelativeImportance)) +"
"0","  geom_col(fill = ""steelblue"") +"
"0","  geom_text(aes(label = paste0(round(RelativeImportance, 1), ""%"")),"
"0","            hjust = 1.1, color = ""white"", size = 3) +"
"0","  labs("
"0","    title = NULL,"
"0","    subtitle = ""Male"","
"0","    y = ""Variable Importance (%)"","
"0","    x = NULL"
"0","  ) +"
"0","  theme_minimal(base_size = 14) +"
"0","  theme(axis.text.y = element_text(size = 10),"
"0","        plot.title.position = ""plot"",           # aligns title relative to plot, not panel"
"0","        plot.subtitle = element_text(hjust = 0.5) ) + "
"0","  coord_flip()"
"0",""
"0","# Combine vertically"
"0","female_plot / male_plot"
"0",""
